$('body').addClass('loading');$(window).on('load',function(){$('body').removeClass('loading');$('.modal.auto-show').each(function(){if(!$('body').hasClass('modal-open')){$(this).modal('show').addClass('shown');}
$(this).on('hidden.bs.modal',function(e){$('.modal.auto-show:not(.shown)').first().modal('show').addClass('shown');});});});$('form').submit(function(){if(!$('body').hasClass('live'))$('body').addClass('loading');});$(document).on({ajaxStart:function(){if(!$('body').hasClass('live'))$('body').addClass('loading');},ajaxStop:function(){$('body').removeClass('loading');}});$('.toast').toast('show');$('.multiple-choice input[type=checkbox]').change(function(){if($(this).prop('checked')){$(this).parents('label.choice').addClass('selected');}else{$(this).parents('label.choice').removeClass('selected');}});function modalAlert(title=gettext('Error'),body=gettext('Error'),btnDismissText=gettext('Close')){var modal='<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">'+'<div class="modal-dialog modal-dialog-centered modal-sm">'+'<div class="modal-content">'+'<div class="modal-header">'+'<div class="modal-title mx-auto" id="modal-label-{{ forloop.counter0 }}">'+title+'</div>'+'</div>'+'<div class="modal-body">'+body+'</div>'+'<div class="modal-footer">'+'<button type="button" class="btn btn-primary mx-auto" data-dismiss="modal">'+btnDismissText+'</button>'+'</div>'+'</div>'+'</div>'+'</div>';$('.wrapper').append(modal);$('.modal:last').modal('show').addClass('shown');};;var maxCanvasWidth=4096,maxCanvasHeight=4096;var acceptedFileType=['jpg','jpeg','png'];Compressor.setDefaults({mimeType:'image/png',maxWidth:1050,maxHeight:800,convertSize:2000000,});$('.btn-webcam').click(function(){var video=document.getElementById('vid-webcam'),mediaConfig={video:true},errorConsole=function(error){console.error('getUserMedia() error:',error);modalAlert(gettext('Error'),gettext('No camera media is detected'));};if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){navigator.mediaDevices.getUserMedia(mediaConfig).then(function(stream){video.srcObject=stream;video.play();$('.default-container, .preview-container, #btn-skip').hide();$('.webcam-container').show();});}
else if(navigator.getUserMedia){navigator.getUserMedia(mediaConfig,function(stream){video.src=stream;video.play();$('.default-container, .preview-container, #btn-skip').hide();$('.webcam-container').show();},errorConsole);}else if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(mediaConfig,function(stream){video.play();$('.default-container, .preview-container, #btn-skip').hide();$('.webcam-container').show();},errorConsole);}else if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(mediaConfig,function(stream){video.play();$('.default-container, .preview-container, #btn-skip').hide();$('.webcam-container').show();},errorConsole);}});$('#btn-capture').click(function(){var video=document.getElementById('vid-webcam'),stream=video.srcObject,tracks=stream.getTracks(),$img=$('#img-preview'),draw=document.createElement('canvas'),context2D=draw.getContext('2d');draw.width=video.videoWidth;draw.height=video.videoHeight;context2D.drawImage(video,0,0,video.videoWidth,video.videoHeight);tracks.forEach(function(track){track.stop();});new Compressor(dataURLtoBlob(draw.toDataURL('image/png')),{success:function(result){blobToDataURL(result,function(dataURL){$img.attr('src',dataURL);$('.page-header, .page-subheader, .default-container, .webcam-container').hide();$('.preview-container, #btn-skip').show();});},error:function(err){console.error('Compressor() error:'+err.message);modalAlert(gettext('Error'),gettext('Error capturing image'));},});});$('#btn-next').click(function(){var imgData=$('#img-preview').attr('src'),imgType=imgData.substring("data:image/".length,imgData.indexOf(";base64")),index=imgType=='jpeg'?23:22,$frFile=$('#id_fr_file');$frFile.val(imgData.substring(index));$('#form-fr').submit();});function blobToDataURL(blob,callback){var reader=new FileReader();reader.onload=function(e){callback(e.target.result);}
reader.readAsDataURL(blob);}
function dataURLtoBlob(dataURL){var arr=dataURL.split(','),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--){u8arr[n]=bstr.charCodeAt(n);}
return new Blob([u8arr],{type:mime});};